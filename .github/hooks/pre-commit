#!/bin/bash

# Pre-commit hook for documentation quality checks
# This script runs documentation quality checks before commits

echo "ğŸ” Running documentation quality checks..."

# Check if there are any markdown files being committed
MARKDOWN_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.md$')

if [ -z "$MARKDOWN_FILES" ]; then
    echo "âœ… No markdown files to check"
    exit 0
fi

echo "ğŸ“‹ Found markdown files to check:"
echo "$MARKDOWN_FILES"

# Run markdownlint on staged files
echo "ğŸ”§ Running markdownlint..."
if ! npm run docs:lint -- $MARKDOWN_FILES; then
    echo "âŒ Markdownlint failed. Please fix the issues before committing."
    exit 1
fi

# Check internal links for staged files
echo "ğŸ”— Checking internal links..."
for file in $MARKDOWN_FILES; do
    if ! node .github/scripts/check-internal-links.cjs "$file"; then
        echo "âŒ Internal link check failed for $file"
        exit 1
    fi
done

# Check image references for staged files
echo "ğŸ–¼ï¸  Checking image references..."
for file in $MARKDOWN_FILES; do
    if ! node .github/scripts/check-images.cjs "$file"; then
        echo "âŒ Image reference check failed for $file"
        exit 1
    fi
done

echo "âœ… All documentation quality checks passed!"
exit 0